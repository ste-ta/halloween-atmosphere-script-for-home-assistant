alias: ðŸŽ„ Christmas Atmosphere
description: >-
  Creates various Christmas lighting effects (optimized for older Philips Hue
  bulbs, uses XY color space for better Zigbee compatibility and includes error
  recovery to prevent bulb freezing).
mode: restart
max_exceeded: silent
fields:
  lights:
    description: List of light entity IDs
    example: light.living_room, light.hallway, light.kitchen
    selector:
      entity:
        multiple: true
        domain: light
  effect:
    description: Which effect to play
    example: xmas_tree
    selector:
      select:
        options:
          - xmas_tree
          - xmas_snowfall
          - xmas_candlelight
          - xmas_fireplace
          - xmas_santa
          - xmas_dinner
          - xmas_party
          - stop
variables:
  lights_list: |
    {{ lights if lights is iterable and lights is not string else [lights] }}
  scene_backup_id: christmas_script_backup
sequence:
  - choose:
      - conditions:
          - condition: template
            value_template: "{{ effect != 'stop' }}"
        sequence:
          - data:
              scene_id: "{{ scene_backup_id }}"
              snapshot_entities: "{{ lights_list }}"
            continue_on_error: true
            action: scene.create
  - choose:
      - conditions:
          - condition: template
            value_template: "{{ effect == 'stop' }}"
        sequence:
          - target:
              entity_id: scene.{{ scene_backup_id }}
            data:
              transition: 2
            continue_on_error: true
            action: scene.turn_on
          - delay:
              milliseconds: 2000
          - continue_on_error: true
            action: scene.delete
            target:
              entity_id: scene.{{ scene_backup_id }}
          - stop: Christmas effect stopped
      - conditions:
          - condition: template
            value_template: "{{ effect == 'xmas_tree' }}"
        sequence:
          - repeat:
              for_each: "{{ lights_list }}"
              sequence:
                - target:
                    entity_id: "{{ repeat.item }}"
                  data:
                    brightness: 110
                  continue_on_error: true
                  action: light.turn_on
                - delay:
                    milliseconds: 200
          - delay:
              seconds: 1
          - repeat:
              until:
                - condition: template
                  value_template: "{{ false }}"
              sequence:
                - repeat:
                    for_each: "{{ lights_list }}"
                    sequence:
                      - variables:
                          tree_colors:
                            - - 0.2138
                              - 0.7097
                            - - 0.6389
                              - 0.3548
                            - - 0.3227
                              - 0.329
                          base_xy: "{{ tree_colors | random }}"
                          bright: "{{ range(110, 180) | random }}"
                      - target:
                          entity_id: "{{ repeat.item }}"
                        data:
                          xy_color:
                            - "{{ base_xy[0] }}"
                            - "{{ base_xy[1] }}"
                          brightness: "{{ bright }}"
                          transition: 2
                        continue_on_error: true
                        action: light.turn_on
                      - delay:
                          seconds: 1
                - delay:
                    seconds: "{{ range(6, 10) | random }}"
      - conditions:
          - condition: template
            value_template: "{{ effect == 'xmas_snowfall' }}"
        sequence:
          - repeat:
              for_each: "{{ lights_list }}"
              sequence:
                - target:
                    entity_id: "{{ repeat.item }}"
                  data:
                    brightness: 60
                    xy_color:
                      - 0.1532
                      - 0.2947
                  continue_on_error: true
                  action: light.turn_on
                - delay:
                    seconds: 1
          - delay:
              seconds: 2
          - repeat:
              until:
                - condition: template
                  value_template: "{{ false }}"
              sequence:
                - parallel:
                    - sequence:
                        - delay:
                            seconds: "{{ range(0, 1) | random }}"
                        - repeat:
                            until:
                              - condition: template
                                value_template: "{{ false }}"
                            sequence:
                              - variables:
                                  blues:
                                    - - 0.1532
                                      - 0.2947
                                    - - 0.1781
                                      - 0.2843
                                    - - 0.1607
                                      - 0.2218
                                    - - 0.3227
                                      - 0.329
                                  base_xy: "{{ blues | random }}"
                                  bright: "{{ range(50, 130) | random }}"
                              - target:
                                  entity_id: "{{ lights_list[0] }}"
                                data:
                                  xy_color:
                                    - "{{ base_xy[0] }}"
                                    - "{{ base_xy[1] }}"
                                  brightness: "{{ bright }}"
                                  transition: "{{ range(2, 4) | random }}"
                                continue_on_error: true
                                action: light.turn_on
                              - delay:
                                  seconds: "{{ range(2, 3) | random }}"
                    - sequence:
                        - delay:
                            seconds: "{{ range(0.5, 1.5) | random }}"
                        - repeat:
                            until:
                              - condition: template
                                value_template: "{{ false }}"
                            sequence:
                              - variables:
                                  blues:
                                    - - 0.1532
                                      - 0.2947
                                    - - 0.1781
                                      - 0.2843
                                    - - 0.1607
                                      - 0.2218
                                    - - 0.3227
                                      - 0.329
                                  base_xy: "{{ blues | random }}"
                                  bright: "{{ range(55, 135) | random }}"
                              - target:
                                  entity_id: >-
                                    {{ lights_list[1] if lights_list|length > 1
                                    else lights_list[0] }}
                                data:
                                  xy_color:
                                    - "{{ base_xy[0] }}"
                                    - "{{ base_xy[1] }}"
                                  brightness: "{{ bright }}"
                                  transition: "{{ range(2, 4) | random }}"
                                continue_on_error: true
                                action: light.turn_on
                              - delay:
                                  seconds: "{{ range(2, 3) | random }}"
                    - sequence:
                        - delay:
                            seconds: "{{ range(1, 2) | random }}"
                        - repeat:
                            until:
                              - condition: template
                                value_template: "{{ false }}"
                            sequence:
                              - variables:
                                  blues:
                                    - - 0.1532
                                      - 0.2947
                                    - - 0.1781
                                      - 0.2843
                                    - - 0.1607
                                      - 0.2218
                                    - - 0.3227
                                      - 0.329
                                  base_xy: "{{ blues | random }}"
                                  bright: "{{ range(50, 125) | random }}"
                              - target:
                                  entity_id: >-
                                    {{ lights_list[2] if lights_list|length > 2
                                    else lights_list[0] }}
                                data:
                                  xy_color:
                                    - "{{ base_xy[0] }}"
                                    - "{{ base_xy[1] }}"
                                  brightness: "{{ bright }}"
                                  transition: "{{ range(2, 4) | random }}"
                                continue_on_error: true
                                action: light.turn_on
                              - delay:
                                  seconds: "{{ range(2, 3) | random }}"
                - delay:
                    seconds: "{{ range(1, 2) | random }}"
      - conditions:
          - condition: template
            value_template: "{{ effect == 'xmas_candlelight' }}"
        sequence:
          - repeat:
              for_each: "{{ lights_list }}"
              sequence:
                - target:
                    entity_id: "{{ repeat.item }}"
                  data:
                    brightness: 75
                    xy_color:
                      - 0.5
                      - 0.4
                  continue_on_error: true
                  action: light.turn_on
                - delay:
                    seconds: 1
          - delay:
              seconds: 2
          - repeat:
              until:
                - condition: template
                  value_template: "{{ false }}"
              sequence:
                - parallel:
                    - sequence:
                        - delay:
                            seconds: "{{ range(0, 2) | random }}"
                        - repeat:
                            until:
                              - condition: template
                                value_template: "{{ false }}"
                            sequence:
                              - variables:
                                  base_xy:
                                    - 0.5
                                    - 0.4
                                  x_jitter: "{{ (range(-15, 16) | random) / 1000 }}"
                                  y_jitter: "{{ (range(-10, 11) | random) / 1000 }}"
                                  chosen_x: "{{ (base_xy[0] + x_jitter) | round(4) }}"
                                  chosen_y: "{{ (base_xy[1] + y_jitter) | round(4) }}"
                                  bright: "{{ range(75, 90) | random }}"
                              - target:
                                  entity_id: "{{ lights_list[0] }}"
                                data:
                                  xy_color:
                                    - "{{ chosen_x }}"
                                    - "{{ chosen_y }}"
                                  brightness: "{{ bright }}"
                                  transition: 0.5
                                continue_on_error: true
                                action: light.turn_on
                              - delay:
                                  milliseconds: "{{ range(2000, 3500) | random }}"
                              - target:
                                  entity_id: "{{ lights_list[0] }}"
                                data:
                                  brightness: "{{ range(70, 80) | random }}"
                                  transition: 0.08
                                continue_on_error: true
                                action: light.turn_on
                              - delay:
                                  milliseconds: "{{ range(50, 120) | random }}"
                              - target:
                                  entity_id: "{{ lights_list[0] }}"
                                data:
                                  brightness: "{{ range(78, 88) | random }}"
                                  transition: 0.1
                                continue_on_error: true
                                action: light.turn_on
                              - delay:
                                  milliseconds: "{{ range(100, 250) | random }}"
                    - sequence:
                        - delay:
                            seconds: "{{ range(1, 3) | random }}"
                        - repeat:
                            until:
                              - condition: template
                                value_template: "{{ false }}"
                            sequence:
                              - variables:
                                  base_xy:
                                    - 0.5
                                    - 0.4
                                  x_jitter: "{{ (range(-15, 16) | random) / 1000 }}"
                                  y_jitter: "{{ (range(-10, 11) | random) / 1000 }}"
                                  chosen_x: "{{ (base_xy[0] + x_jitter) | round(4) }}"
                                  chosen_y: "{{ (base_xy[1] + y_jitter) | round(4) }}"
                                  bright: "{{ range(75, 90) | random }}"
                              - target:
                                  entity_id: >-
                                    {{ lights_list[1] if lights_list|length > 1
                                    else lights_list[0] }}
                                data:
                                  xy_color:
                                    - "{{ chosen_x }}"
                                    - "{{ chosen_y }}"
                                  brightness: "{{ bright }}"
                                  transition: 0.5
                                continue_on_error: true
                                action: light.turn_on
                              - delay:
                                  milliseconds: "{{ range(2200, 3800) | random }}"
                              - target:
                                  entity_id: >-
                                    {{ lights_list[1] if lights_list|length > 1
                                    else lights_list[0] }}
                                data:
                                  brightness: "{{ range(70, 82) | random }}"
                                  transition: 0.08
                                continue_on_error: true
                                action: light.turn_on
                              - delay:
                                  milliseconds: "{{ range(60, 140) | random }}"
                              - target:
                                  entity_id: >-
                                    {{ lights_list[1] if lights_list|length > 1
                                    else lights_list[0] }}
                                data:
                                  brightness: "{{ range(78, 88) | random }}"
                                  transition: 0.1
                                continue_on_error: true
                                action: light.turn_on
                              - delay:
                                  milliseconds: "{{ range(150, 300) | random }}"
                    - sequence:
                        - delay:
                            seconds: "{{ range(2, 4) | random }}"
                        - repeat:
                            until:
                              - condition: template
                                value_template: "{{ false }}"
                            sequence:
                              - variables:
                                  base_xy:
                                    - 0.5
                                    - 0.4
                                  x_jitter: "{{ (range(-15, 16) | random) / 1000 }}"
                                  y_jitter: "{{ (range(-10, 11) | random) / 1000 }}"
                                  chosen_x: "{{ (base_xy[0] + x_jitter) | round(4) }}"
                                  chosen_y: "{{ (base_xy[1] + y_jitter) | round(4) }}"
                                  bright: "{{ range(75, 90) | random }}"
                              - target:
                                  entity_id: >-
                                    {{ lights_list[2] if lights_list|length > 2
                                    else lights_list[0] }}
                                data:
                                  xy_color:
                                    - "{{ chosen_x }}"
                                    - "{{ chosen_y }}"
                                  brightness: "{{ bright }}"
                                  transition: 0.5
                                continue_on_error: true
                                action: light.turn_on
                              - delay:
                                  milliseconds: "{{ range(1800, 3200) | random }}"
                              - target:
                                  entity_id: >-
                                    {{ lights_list[2] if lights_list|length > 2
                                    else lights_list[0] }}
                                data:
                                  brightness: "{{ range(71, 81) | random }}"
                                  transition: 0.08
                                continue_on_error: true
                                action: light.turn_on
                              - delay:
                                  milliseconds: "{{ range(55, 130) | random }}"
                              - target:
                                  entity_id: >-
                                    {{ lights_list[2] if lights_list|length > 2
                                    else lights_list[0] }}
                                data:
                                  brightness: "{{ range(78, 88) | random }}"
                                  transition: 0.1
                                continue_on_error: true
                                action: light.turn_on
                              - delay:
                                  milliseconds: "{{ range(120, 280) | random }}"
                - delay:
                    seconds: "{{ range(2, 4) | random }}"
      - conditions:
          - condition: template
            value_template: "{{ effect == 'xmas_fireplace' }}"
        sequence:
          - repeat:
              for_each: "{{ lights_list }}"
              sequence:
                - target:
                    entity_id: "{{ repeat.item }}"
                  data:
                    brightness: 120
                    xy_color:
                      - 0.55
                      - 0.39
                  continue_on_error: true
                  action: light.turn_on
                - delay:
                    seconds: 1
          - delay:
              seconds: 2
          - repeat:
              until:
                - condition: template
                  value_template: "{{ false }}"
              sequence:
                - parallel:
                    - sequence:
                        - delay:
                            seconds: "{{ range(0, 2) | random }}"
                        - repeat:
                            until:
                              - condition: template
                                value_template: "{{ false }}"
                            sequence:
                              - variables:
                                  base_xy:
                                    - 0.55
                                    - 0.39
                                  x_jitter: "{{ (range(-25, 26) | random) / 1000 }}"
                                  y_jitter: "{{ (range(-15, 16) | random) / 1000 }}"
                                  chosen_x: "{{ (base_xy[0] + x_jitter) | round(4) }}"
                                  chosen_y: "{{ (base_xy[1] + y_jitter) | round(4) }}"
                                  bright: "{{ range(100, 180) | random }}"
                              - target:
                                  entity_id: "{{ lights_list[0] }}"
                                data:
                                  xy_color:
                                    - "{{ chosen_x }}"
                                    - "{{ chosen_y }}"
                                  brightness: "{{ bright }}"
                                  transition: "{{ range(2, 4) | random }}"
                                continue_on_error: true
                                action: light.turn_on
                              - delay:
                                  seconds: "{{ range(2, 4) | random }}"
                    - sequence:
                        - delay:
                            seconds: "{{ range(1, 3) | random }}"
                        - repeat:
                            until:
                              - condition: template
                                value_template: "{{ false }}"
                            sequence:
                              - variables:
                                  base_xy:
                                    - 0.55
                                    - 0.39
                                  x_jitter: "{{ (range(-25, 26) | random) / 1000 }}"
                                  y_jitter: "{{ (range(-15, 16) | random) / 1000 }}"
                                  chosen_x: "{{ (base_xy[0] + x_jitter) | round(4) }}"
                                  chosen_y: "{{ (base_xy[1] + y_jitter) | round(4) }}"
                                  bright: "{{ range(100, 180) | random }}"
                              - target:
                                  entity_id: >-
                                    {{ lights_list[1] if lights_list|length > 1
                                    else lights_list[0] }}
                                data:
                                  xy_color:
                                    - "{{ chosen_x }}"
                                    - "{{ chosen_y }}"
                                  brightness: "{{ bright }}"
                                  transition: "{{ range(2, 4) | random }}"
                                continue_on_error: true
                                action: light.turn_on
                              - delay:
                                  seconds: "{{ range(2, 4) | random }}"
                    - sequence:
                        - delay:
                            seconds: "{{ range(2, 4) | random }}"
                        - repeat:
                            until:
                              - condition: template
                                value_template: "{{ false }}"
                            sequence:
                              - variables:
                                  base_xy:
                                    - 0.55
                                    - 0.39
                                  x_jitter: "{{ (range(-25, 26) | random) / 1000 }}"
                                  y_jitter: "{{ (range(-15, 16) | random) / 1000 }}"
                                  chosen_x: "{{ (base_xy[0] + x_jitter) | round(4) }}"
                                  chosen_y: "{{ (base_xy[1] + y_jitter) | round(4) }}"
                                  bright: "{{ range(100, 180) | random }}"
                              - target:
                                  entity_id: >-
                                    {{ lights_list[2] if lights_list|length > 2
                                    else lights_list[0] }}
                                data:
                                  xy_color:
                                    - "{{ chosen_x }}"
                                    - "{{ chosen_y }}"
                                  brightness: "{{ bright }}"
                                  transition: "{{ range(2, 4) | random }}"
                                continue_on_error: true
                                action: light.turn_on
                              - delay:
                                  seconds: "{{ range(2, 4) | random }}"
                - delay:
                    seconds: "{{ range(2, 4) | random }}"
      - conditions:
          - condition: template
            value_template: "{{ effect == 'xmas_santa' }}"
        sequence:
          - repeat:
              for_each: "{{ lights_list }}"
              sequence:
                - target:
                    entity_id: "{{ repeat.item }}"
                  data:
                    brightness: 90
                    xy_color:
                      - 0.3227
                      - 0.329
                  continue_on_error: true
                  action: light.turn_on
                - delay:
                    seconds: 1
          - delay:
              seconds: 3
          - repeat:
              until:
                - condition: template
                  value_template: "{{ false }}"
              sequence:
                - repeat:
                    for_each: "{{ lights_list }}"
                    sequence:
                      - variables:
                          santa_colors:
                            - - 0.6389
                              - 0.3548
                            - - 0.3227
                              - 0.329
                            - - 0.2138
                              - 0.7097
                          base_xy: "{{ santa_colors | random }}"
                          bright: "{{ range(100, 160) | random }}"
                      - target:
                          entity_id: "{{ repeat.item }}"
                        data:
                          xy_color:
                            - "{{ base_xy[0] }}"
                            - "{{ base_xy[1] }}"
                          brightness: "{{ bright }}"
                          transition: "{{ range(5, 8) | random }}"
                        continue_on_error: true
                        action: light.turn_on
                      - delay:
                          seconds: 1
                - delay:
                    seconds: "{{ range(7, 11) | random }}"
      
######
      - conditions:
          - condition: template
            value_template: "{{ effect == 'xmas_dinner' }}"
        sequence:
          - repeat:
              for_each: "{{ lights_list }}"
              sequence:
                - target:
                    entity_id: "{{ repeat.item }}"
                  data:
                    brightness: 100
                    xy_color:
                      - 0.433
                      - 0.399
                  continue_on_error: true
                  action: light.turn_on
                - delay:
                    seconds: 1
          - delay:
              seconds: 3
          - repeat:
              until:
                - condition: template
                  value_template: "{{ false }}"
              sequence:
                - parallel:
                    - sequence:
                        - delay:
                            seconds: "{{ range(0, 2) | random }}"
                        - repeat:
                            until:
                              - condition: template
                                value_template: "{{ false }}"
                            sequence:
                              - variables:
                                  dinner_colors:
                                    - - 0.433
                                      - 0.399
                                    - - 0.45
                                      - 0.39
                                    - - 0.42
                                      - 0.405
                                    - - 0.44
                                      - 0.395
                                  base_xy: "{{ dinner_colors | random }}"
                                  bright: "{{ range(85, 130) | random }}"
                              - target:
                                  entity_id: "{{ lights_list[0] }}"
                                data:
                                  xy_color:
                                    - "{{ base_xy[0] }}"
                                    - "{{ base_xy[1] }}"
                                  brightness: "{{ bright }}"
                                  transition: "{{ range(8, 12) | random }}"
                                continue_on_error: true
                                action: light.turn_on
                              - delay:
                                  seconds: "{{ range(8, 12) | random }}"
                    - sequence:
                        - delay:
                            seconds: "{{ range(2, 5) | random }}"
                        - repeat:
                            until:
                              - condition: template
                                value_template: "{{ false }}"
                            sequence:
                              - variables:
                                  dinner_colors:
                                    - - 0.433
                                      - 0.399
                                    - - 0.45
                                      - 0.39
                                    - - 0.42
                                      - 0.405
                                    - - 0.44
                                      - 0.395
                                  base_xy: "{{ dinner_colors | random }}"
                                  bright: "{{ range(85, 130) | random }}"
                              - target:
                                  entity_id: "{{ lights_list[1] if lights_list|length > 1 else lights_list[0] }}"
                                data:
                                  xy_color:
                                    - "{{ base_xy[0] }}"
                                    - "{{ base_xy[1] }}"
                                  brightness: "{{ bright }}"
                                  transition: "{{ range(8, 12) | random }}"
                                continue_on_error: true
                                action: light.turn_on
                              - delay:
                                  seconds: "{{ range(8, 12) | random }}"
                    - sequence:
                        - delay:
                            seconds: "{{ range(4, 8) | random }}"
                        - repeat:
                            until:
                              - condition: template
                                value_template: "{{ false }}"
                            sequence:
                              - variables:
                                  dinner_colors:
                                    - - 0.433
                                      - 0.399
                                    - - 0.45
                                      - 0.39
                                    - - 0.42
                                      - 0.405
                                    - - 0.44
                                      - 0.395
                                  base_xy: "{{ dinner_colors | random }}"
                                  bright: "{{ range(85, 130) | random }}"
                              - target:
                                  entity_id: "{{ lights_list[2] if lights_list|length > 2 else lights_list[0] }}"
                                data:
                                  xy_color:
                                    - "{{ base_xy[0] }}"
                                    - "{{ base_xy[1] }}"
                                  brightness: "{{ bright }}"
                                  transition: "{{ range(8, 12) | random }}"
                                continue_on_error: true
                                action: light.turn_on
                              - delay:
                                  seconds: "{{ range(8, 12) | random }}"
                - delay:
                    seconds: "{{ range(3, 6) | random }}"


####
      
      - conditions:
          - condition: template
            value_template: "{{ effect == 'xmas_party' }}"
        sequence:
          - repeat:
              until:
                - condition: template
                  value_template: "{{ false }}"
              sequence:
                - repeat:
                    count: 8
                    sequence:
                      - variables:
                          strobe_color: >-
                            {{ [['0.6389', '0.3548'], ['0.2138', '0.7097'],
                            ['0.3227', '0.329']] | random }}
                      - repeat:
                          for_each: "{{ lights_list }}"
                          sequence:
                            - target:
                                entity_id: "{{ repeat.item }}"
                              data:
                                brightness: 255
                                xy_color:
                                  - "{{ strobe_color[0] | float }}"
                                  - "{{ strobe_color[1] | float }}"
                                transition: 0
                              continue_on_error: true
                              action: light.turn_on
                            - delay:
                                milliseconds: 100
                      - delay:
                          milliseconds: 300
                      - repeat:
                          for_each: "{{ lights_list }}"
                          sequence:
                            - target:
                                entity_id: "{{ repeat.item }}"
                              data:
                                brightness: 150
                                transition: 0
                              continue_on_error: true
                              action: light.turn_on
                            - delay:
                                milliseconds: 100
                      - delay:
                          milliseconds: 300
                - delay:
                    seconds: 1
                - repeat:
                    count: 8
                    sequence:
                      - repeat:
                          for_each: "{{ lights_list }}"
                          sequence:
                            - target:
                                entity_id: "{{ repeat.item }}"
                              data:
                                brightness: 255
                                xy_color:
                                  - 0.6389
                                  - 0.3548
                                transition: 0
                              continue_on_error: true
                              action: light.turn_on
                            - delay:
                                milliseconds: 100
                      - delay:
                          milliseconds: 300
                      - repeat:
                          for_each: "{{ lights_list }}"
                          sequence:
                            - target:
                                entity_id: "{{ repeat.item }}"
                              data:
                                brightness: 255
                                xy_color:
                                  - 0.2138
                                  - 0.7097
                                transition: 0
                              continue_on_error: true
                              action: light.turn_on
                            - delay:
                                milliseconds: 100
                      - delay:
                          milliseconds: 300
                      - repeat:
                          for_each: "{{ lights_list }}"
                          sequence:
                            - target:
                                entity_id: "{{ repeat.item }}"
                              data:
                                brightness: 255
                                xy_color:
                                  - 0.3227
                                  - 0.329
                                transition: 0
                              continue_on_error: true
                              action: light.turn_on
                            - delay:
                                milliseconds: 100
                      - delay:
                          milliseconds: 300
                - delay:
                    seconds: 1
                - repeat:
                    count: 8
                    sequence:
                      - repeat:
                          for_each: "{{ lights_list }}"
                          sequence:
                            - target:
                                entity_id: "{{ repeat.item }}"
                              data:
                                brightness: 255
                                xy_color:
                                  - 0.6389
                                  - 0.3548
                                transition: 0
                              continue_on_error: true
                              action: light.turn_on
                            - delay:
                                milliseconds: 100
                      - delay:
                          milliseconds: 300
                      - repeat:
                          for_each: "{{ lights_list }}"
                          sequence:
                            - target:
                                entity_id: "{{ repeat.item }}"
                              data:
                                brightness: 150
                                transition: 0
                              continue_on_error: true
                              action: light.turn_on
                            - delay:
                                milliseconds: 100
                      - delay:
                          milliseconds: 300
                - delay:
                    seconds: 1
                - repeat:
                    count: 8
                    sequence:
                      - repeat:
                          for_each: "{{ lights_list }}"
                          sequence:
                            - variables:
                                light_index: "{{ lights_list.index(repeat.item) }}"
                                solo_colors:
                                  - - 0.6389
                                    - 0.3548
                                  - - 0.2138
                                    - 0.7097
                                  - - 0.3227
                                    - 0.329
                                solo_color: "{{ solo_colors[light_index % 3] }}"
                            - target:
                                entity_id: "{{ repeat.item }}"
                              data:
                                brightness: 255
                                xy_color:
                                  - "{{ solo_color[0] }}"
                                  - "{{ solo_color[1] }}"
                                transition: 0
                              continue_on_error: true
                              action: light.turn_on
                            - delay:
                                milliseconds: 100
                      - delay:
                          milliseconds: 700
                      - repeat:
                          for_each: "{{ lights_list }}"
                          sequence:
                            - target:
                                entity_id: "{{ repeat.item }}"
                              data:
                                brightness: 100
                                transition: 0
                              continue_on_error: true
                              action: light.turn_on
                            - delay:
                                milliseconds: 100
                      - delay:
                          milliseconds: 300
                - delay:
                    seconds: 1
